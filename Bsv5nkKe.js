import{d as Q,f as W,j as f,i as $,r as B,w as z,o as I,c,e as t,v as r,J as m,K as k,n as d,l as i,k as P,a as X,u as Y,L as j,M as N,m as p,b as u,t as _,q as Z,Q as S}from"./assets/index-B6Sr_t6A.js";import{a as ee}from"./g79jvVlz.js";import{g as te,c as ae,a as se}from"./CDmwd7Gc.js";const oe={key:0,class:"detail w-[1100px] mx-auto my-0 flex"},ne={class:"w-[600px] mr-4"},le={class:"flex bg-white dark:bg-gray-700 p-4 rounded mb-4"},re=["src"],ue={class:"flex-1 px-4"},ce={class:"text-4xl text-gray-800 dark:text-gray-100"},ie={class:"flex justify-between items-end"},de={class:"mr-4"},_e={class:"mr-4"},pe={class:"text-red-500 text-2xl"},he={class:"bg-white dark:bg-gray-700 p-4 rounded mb-4"},ye={class:"bg-white dark:bg-gray-700 p-4 rounded mb-4"},fe=t("p",{class:"text-xl mb-2"},"商品详情：",-1),me=["innerHTML"],ve={class:"bg-white dark:bg-gray-700 p-4 rounded mb-4 w-[480px]"},be={class:"flex justify-between items-center mb-2"},ge=t("p",{class:"text-xl"},"购买数量：",-1),xe={class:"flex"},ke={class:"mb-2 text-gray-500"},we={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Ce={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Me={class:"flex justify-between items-center mb-2"},Le=t("p",{class:"text-xl"},"支付方式：",-1),Te={class:"flex"},Be={class:"flex justify-between items-center"},Pe={class:"text-xl"},je={class:"flex"},Ne={key:0,class:"text-right text-red-500"},Se={class:"flex justify-between items-center mb-2"},Ue=t("p",{class:"text-xl"},"总价：",-1),qe={class:"flex text-red-500 text-2xl"},De=["innerHTML"],Fe=Q({__name:"index",setup(He){const U=X(),q=Y(),C=W(),o=f({actual_price:0,actual_price_label:"",buy_limit_num:0,buy_prompt:"",created_at:"",gd_description:"",gd_keywords:[],gd_name:"",gd_no:"",in_stock:0,is_automatic:0,ord:0,other_ipu_cnf:[],picture:"",retail_price:0,retail_price_label:"",sales_volume:0,type:1,wholesale_price_cnf:[]}),D=$(()=>{let e=0;for(let a=0;a<o.value.wholesale_price_cnf.length;a++){const n=o.value.wholesale_price_cnf[a];if(l.buy_num>=n.buy_num){e=n.price*l.buy_num;break}else e=o.value.retail_price*l.buy_num}return M(e)});function M(e){let a="";const n=Math.floor(e/1e4),b=Math.floor(e%1e4/100),g=e%100;return n&&(a+=n+" 金币"),b&&(a+=b+" 银币"),g&&(a+=g+" 铜币"),a}function H(){ee(l.gd_no).then(e=>{o.value={...e,wholesale_price_cnf:e.wholesale_price_cnf.map(a=>{const n=a.split("=");return{buy_num:+n[0],price:+n[1]}}).sort((a,n)=>n.buy_num-a.buy_num),other_ipu_cnf:e.other_ipu_cnf.map(a=>{const n=a.split("=");return{key:n[0],label:n[1],required:n[2]==="true",status:""}})}}).catch(()=>{l.gd_no=""})}function V(e){if(e)e.startsWith("http")?open(e,"_blank"):S({url:e,hideError:!0}).then(()=>{v.value=!1}).catch(a=>{v.value=!0,N.alert({content:a.data.message})});else return}const l=B({buy_num:1,gd_no:"",other_ipu:{}}),h=B({orderNo:"",payCheck:""});z(l,L);function L(){o.value.other_ipu_cnf.forEach(e=>{e.required&&!l.other_ipu[e.key]?e.status="error":e.status=""})}function E(){if(L(),o.value.other_ipu_cnf.some(e=>e.status)){j.error({content:"请填写完整信息"});return}if(!C.account_id){N.info({title:"请登录",content:"请先登录后再购买"});return}o.value.pre_api_hook&&V(o.value.pre_api_hook),y.value=!0}const y=f(!1),w=f(!1);function A(){w.value=!0,ae(l).then(e=>{h.orderNo=e.order_no,F(),y.value=!1}).finally(()=>{w.value=!1})}const v=f(!1);function F(){se(h).catch(e=>{var a,n;e.status===303&&(n=(a=e.data)==null?void 0:a.data)!=null&&n.hook_url&&S({url:e.data.data.hook_url,method:"post"}).then(()=>{j.success("支付成功"),q.push("/order")})})}const T=f([]);function O(){te().then(e=>{T.value=e,h.payCheck=e[0].pay_check}).catch(()=>{})}return I(()=>{l.gd_no=U.query.id||"",l.gd_no&&(H(),C.account_id&&O())}),(e,a)=>{const n=p("a-input-number"),b=p("a-radio-button"),g=p("a-radio-group"),R=p("a-input"),x=p("a-button"),G=p("a-result"),J=p("a-modal");return u(),c(m,null,[l.gd_no?(u(),c("div",oe,[t("div",ne,[t("div",le,[t("img",{src:o.value.picture,alt:"",class:"w-28 h-28 rounded"},null,8,re),t("div",ue,[t("p",ce,[t("span",null,r(o.value.gd_name),1)]),t("div",ie,[t("p",null,[t("span",de,"已售："+r(o.value.sales_volume),1),t("span",_e,"库存："+r(o.value.in_stock),1)]),t("span",pe,"单价："+r(o.value.retail_price_label),1)])])]),t("div",he,[(u(!0),c(m,null,k(o.value.gd_keywords,s=>(u(),c("span",{key:l.gd_no+s,class:"py-2 px-4 mr-2 rounded bg-gray-200 text-gray-700 dark:bg-gray-500 dark:text-gray-200"},r(s),1))),128))]),t("div",ye,[fe,t("p",{class:"text-gray-500 dark:text-gray-200 py-2",innerHTML:o.value.gd_description},null,8,me)])]),t("div",ve,[t("div",be,[ge,t("div",xe,[d(n,{value:l.buy_num,"onUpdate:value":a[0]||(a[0]=s=>l.buy_num=s),controls:!1,max:o.value.in_stock,min:1,precision:0,class:"w-[190px]"},null,8,["value","max"])])]),t("div",ke,[(u(!0),c(m,null,k(o.value.wholesale_price_cnf,s=>(u(),c("p",{key:s.buy_num},[_(" 购买"),t("span",we,r(s.buy_num),1),_("个按照"),t("span",Ce,r(M(s.price)),1),_("售卖 ")]))),128))]),t("div",Me,[Le,t("div",Te,[d(g,{value:h.payCheck,"onUpdate:value":a[1]||(a[1]=s=>h.payCheck=s),"button-style":"solid"},{default:i(()=>[(u(!0),c(m,null,k(T.value,s=>(u(),P(b,{key:s.pay_check,value:s.pay_check},{default:i(()=>[_(r(s.pay_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),(u(!0),c(m,null,k(o.value.other_ipu_cnf,s=>(u(),c("div",{key:s.key,class:"mb-2"},[t("div",Be,[t("p",Pe,r(s.label)+"：",1),t("div",je,[d(R,{value:l.other_ipu[s.key],"onUpdate:value":K=>l.other_ipu[s.key]=K,placeholder:"请输入"+s.label,status:s.status,class:"w-[190px]"},null,8,["value","onUpdate:value","placeholder","status"])])]),s.status?(u(),c("p",Ne,r("请输入"+s.label),1)):Z("",!0)]))),128)),t("div",Se,[Ue,t("div",qe,r(D.value),1)]),t("div",null,[d(x,{disabled:v.value,class:"w-full",type:"primary",onClick:E},{default:i(()=>[_(r(v.value?"你不配":"立即购买"),1)]),_:1},8,["disabled"])])])])):(u(),P(G,{key:1,class:"bg-white dark:bg-gray-700 w-[1200px] m-auto rounded-2xl",status:"404","sub-title":"抱歉, 您访问的商品不存在。",title:"没找到商品"},{extra:i(()=>[d(x,{type:"primary"},{default:i(()=>[_("首页")]),_:1})]),_:1})),d(J,{open:y.value,"onUpdate:open":a[3]||(a[3]=s=>y.value=s),maskClosable:!1,destroyOnClose:"",title:"购买提示"},{footer:i(()=>[d(x,{onClick:a[2]||(a[2]=s=>y.value=!1)},{default:i(()=>[_("再考虑一下")]),_:1}),d(x,{loading:w.value,type:"primary",onClick:A},{default:i(()=>[_("已知晓，继续购买 ")]),_:1},8,["loading"])]),default:i(()=>[t("div",{innerHTML:o.value.buy_prompt},null,8,De)]),_:1},8,["open"])],64)}}});export{Fe as default};
