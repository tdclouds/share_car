import{d as z,j as J,r as y,n as Q,m as B,p as X,o as Y,a as _,b as r,c,g as e,y as u,v as M,F as b,I as g,e as i,w as d,f as p,q as T,h as Z,u as ee,K as P,M as j,L as N,t as te}from"./assets/index-DPSsBdy6.js";import{a as ae}from"./UQRlXbdz.js";import{c as se,g as oe,a as le}from"./Bs16Q7u9.js";import{f as k}from"./fquX6oEn.js";const ne={key:0,class:"detail w-[1100px] max-w-full sm:flex-wrap mx-auto my-0 flex"},re={class:"w-[600px] max-w-full mr-4 sm:mr-0"},ue={class:"flex bg-white dark:bg-gray-700 p-4 rounded mb-4"},ce=["src"],ie={class:"flex-1 pl-4"},de={class:"text-4xl text-gray-800 dark:text-gray-100 mb-8"},_e={class:"flex justify-between items-end"},pe={class:"sm:flex sm:flex-col"},me={class:"mr-4"},fe={class:"mr-4"},he={class:"text-red-500 text-2xl"},ye={class:"bg-white dark:bg-gray-700 p-4 flex flex-wrap rounded mb-4"},be={class:"bg-white dark:bg-gray-700 p-4 rounded mb-4"},ve=e("p",{class:"text-xl mb-2"},"商品详情：",-1),xe=["innerHTML"],ge={class:"bg-white dark:bg-gray-700 p-4 rounded mb-4 w-[480px] h-[min-content]"},ke={class:"flex justify-between items-center mb-2"},we=e("p",{class:"text-xl"},"购买数量：",-1),Ce={class:"flex"},Le={class:"mb-2 text-gray-500"},Be={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Me={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Te={class:"flex justify-between items-center mb-2"},Pe=e("p",{class:"text-xl"},"支付方式：",-1),je={class:"flex"},Ne={class:"flex justify-between items-center"},Se={class:"text-xl"},Ue={class:"flex"},qe={key:0,class:"text-right text-red-500"},De={class:"flex justify-between items-center mb-2"},He=e("p",{class:"text-xl"},"总价：",-1),Ve={class:"flex text-red-500 text-2xl"},Ee=["innerHTML"],Ie=z({__name:"index",setup(Fe){const S=Z(),U=ee(),w=J(),o=y({actual_price:0,actual_price_label:"",buy_limit_num:0,buy_prompt:"",created_at:"",gd_description:"",gd_keywords:[],gd_name:"",gd_no:"",in_stock:0,is_automatic:0,ord:0,other_ipu_cnf:[],picture:"",retail_price:0,retail_price_label:"",sales_volume:0,type:1,wholesale_price_cnf:[]}),q=Q(()=>{let t=0;for(let s=0;s<o.value.wholesale_price_cnf.length;s++){const n=o.value.wholesale_price_cnf[s];if(l.buy_num>=n.buy_num){t=n.price*l.buy_num;break}else t=o.value.retail_price*l.buy_num}return k(t)});function D(){ae(l.gd_no).then(t=>{o.value={...t,wholesale_price_cnf:(t.wholesale_price_cnf||[]).map(s=>{const n=s.split("=");return{buy_num:+n[0],price:+n[1]}}).sort((s,n)=>n.buy_num-s.buy_num),other_ipu_cnf:(t.other_ipu_cnf||[]).map(s=>{const n=s.split("=");return{key:n[0],label:n[1],required:n[2]==="true",status:""}})}}).catch(()=>{l.gd_no=""})}function H(t){if(t)t.startsWith("http")?open(t,"_blank"):N({url:t,hideError:!0}).then(()=>{v.value=!1}).catch(s=>{v.value=!0,j.alert({content:s.data.message})});else return}const l=B({buy_num:1,gd_no:"",other_ipu:{}}),m=B({orderNo:"",payCheck:""});X(l,C);function C(){o.value.other_ipu_cnf.forEach(t=>{t.required&&!l.other_ipu[t.key]?t.status="error":t.status=""})}function V(){if(C(),o.value.other_ipu_cnf.some(t=>t.status)){P.error({content:"请填写完整信息"});return}if(!w.account_id){j.info({title:"请登录",content:"请先登录后再购买"});return}o.value.pre_api_hook&&H(o.value.pre_api_hook),f.value=!0}const f=y(!1),h=y(!1);function E(){h.value=!0,se(l).then(t=>{m.orderNo=t.order_no,F()}).catch(()=>{h.value=!1})}const v=y(!1);function F(){oe(m).catch(t=>{var s,n;t.status===303&&(n=(s=t.data)==null?void 0:s.data)!=null&&n.hook_url&&N({url:t.data.data.hook_url,method:"post"}).then(()=>{P.success("支付成功"),U.push("/order")}).finally(()=>{h.value=!1,f.value=!1})})}const L=y([]);function A(){le().then(t=>{L.value=t,m.payCheck=t[0].pay_check}).catch(()=>{})}return Y(()=>{l.gd_no=S.query.id||"",l.gd_no&&(D(),w.account_id&&A())}),(t,s)=>{const n=_("a-input-number"),O=_("a-radio-button"),R=_("a-radio-group"),G=_("a-input"),x=_("a-button"),I=_("a-result"),K=_("a-back-top"),W=_("a-modal");return r(),c(b,null,[l.gd_no?(r(),c("div",ne,[e("div",re,[e("div",ue,[e("img",{src:o.value.picture,alt:"",class:"w-28 h-28 rounded"},null,8,ce),e("div",ie,[e("p",de,[e("span",null,u(o.value.gd_name),1)]),e("div",_e,[e("p",pe,[e("span",me,"已售："+u(o.value.sales_volume),1),e("span",fe,"库存："+u(o.value.in_stock),1)]),e("span",he,"单价："+u(M(k)(o.value.retail_price)),1)])])]),e("div",ye,[(r(!0),c(b,null,g(o.value.gd_keywords,a=>(r(),c("div",{key:l.gd_no+a,class:"py-2 px-4 mr-2 rounded bg-gray-200 text-gray-700 dark:bg-gray-500 dark:text-gray-200"},u(a),1))),128))]),e("div",be,[ve,e("p",{class:"text-gray-500 dark:text-gray-200 py-2 break-all",innerHTML:o.value.gd_description},null,8,xe)])]),e("div",ge,[e("div",ke,[we,e("div",Ce,[i(n,{value:l.buy_num,"onUpdate:value":s[0]||(s[0]=a=>l.buy_num=a),controls:!1,disabled:o.value.in_stock==0,max:o.value.buy_limit_num,min:1,precision:0,class:"w-[190px]"},null,8,["value","disabled","max"])])]),e("div",Le,[(r(!0),c(b,null,g(o.value.wholesale_price_cnf,a=>(r(),c("p",{key:a.buy_num},[p(" 购买"),e("span",Be,u(a.buy_num),1),p("个按照"),e("span",Me,u(M(k)(a.price)),1),p("售卖 ")]))),128))]),e("div",Te,[Pe,e("div",je,[i(R,{value:m.payCheck,"onUpdate:value":s[1]||(s[1]=a=>m.payCheck=a),"button-style":"solid"},{default:d(()=>[(r(!0),c(b,null,g(L.value,a=>(r(),T(O,{key:a.pay_check,value:a.pay_check},{default:d(()=>[p(u(a.pay_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),(r(!0),c(b,null,g(o.value.other_ipu_cnf,a=>(r(),c("div",{key:a.key,class:"mb-2"},[e("div",Ne,[e("p",Se,u(a.label)+"：",1),e("div",Ue,[i(G,{value:l.other_ipu[a.key],"onUpdate:value":$=>l.other_ipu[a.key]=$,placeholder:"请输入"+a.label,status:a.status,class:"w-[190px]"},null,8,["value","onUpdate:value","placeholder","status"])])]),a.status?(r(),c("p",qe,u("请输入"+a.label),1)):te("",!0)]))),128)),e("div",De,[He,e("div",Ve,u(q.value),1)]),e("div",null,[i(x,{disabled:v.value,class:"w-full",type:"primary",onClick:V},{default:d(()=>[p(u(v.value?"无法购买":"立即购买"),1)]),_:1},8,["disabled"])])])])):(r(),T(I,{key:1,class:"bg-white dark:bg-gray-700 w-[1200px] m-auto rounded-2xl",status:"404","sub-title":"抱歉, 您访问的商品不存在。",title:"没找到商品"},{extra:d(()=>[i(x,{type:"primary"},{default:d(()=>[p("首页")]),_:1})]),_:1})),i(K),i(W,{open:f.value,"onUpdate:open":s[3]||(s[3]=a=>f.value=a),maskClosable:!1,destroyOnClose:"",title:"购买提示"},{footer:d(()=>[i(x,{onClick:s[2]||(s[2]=a=>f.value=!1),disabled:h.value},{default:d(()=>[p("再考虑一下")]),_:1},8,["disabled"]),i(x,{loading:h.value,type:"primary",onClick:E},{default:d(()=>[p("已知晓，继续购买 ")]),_:1},8,["loading"])]),default:d(()=>[e("div",{innerHTML:o.value.buy_prompt},null,8,Ee)]),_:1},8,["open"])],64)}}});export{Ie as default};
