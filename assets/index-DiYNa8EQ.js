import{d as $,g as z,r as y,j as J,i as L,w as K,o as Q,c,e as t,t as r,G as m,H as k,n as _,l as i,k as N,a as X,u as Y,I as P,M as j,m as p,b as u,s as d,q as Z,N as S}from"./index-CxRpeGzn.js";import{a as ee}from"./good-DCHWYmzi.js";import{g as te,c as se,a as ae}from"./order-DjGF1ju6.js";const oe={key:0,class:"detail w-[1100px] mx-auto my-0 flex"},ne={class:"w-[600px] mr-4"},le={class:"flex bg-white p-4 rounded mb-4"},re=["src"],ue={class:"flex-1 px-4"},ce={class:"text-4xl text-gray-800"},ie={class:"flex justify-between items-end"},_e={class:"mr-4"},de={class:"mr-4"},pe={class:"text-red-500 text-2xl"},he={class:"bg-white p-4 rounded mb-4"},fe={class:"bg-white p-4 rounded mb-4"},ye=t("p",{class:"text-xl mb-2"},"商品详情：",-1),me=["innerHTML"],ve={class:"bg-white p-4 rounded mb-4 w-[480px]"},be={class:"flex justify-between items-center mb-2"},xe=t("p",{class:"text-xl"},"购买数量：",-1),ge={class:"flex"},ke={class:"mb-2 text-gray-500"},we={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Ce={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Me={class:"flex justify-between items-center mb-2"},Te=t("p",{class:"text-xl"},"支付方式：",-1),Be={class:"flex"},Le={class:"flex justify-between items-center"},Ne={class:"text-xl"},Pe={class:"flex"},je={key:0,class:"text-right text-red-500"},Se={class:"flex justify-between items-center mb-2"},Ue=t("p",{class:"text-xl"},"总价：",-1),qe={class:"flex text-red-500 text-2xl"},De=["innerHTML"],Fe=$({__name:"index",setup(He){const U=X(),q=Y(),C=z(),o=y({actual_price:0,actual_price_label:"",buy_limit_num:0,buy_prompt:"",created_at:"",gd_description:"",gd_keywords:[],gd_name:"",gd_no:"",in_stock:0,is_automatic:0,ord:0,other_ipu_cnf:[],picture:"",retail_price:0,retail_price_label:"",sales_volume:0,type:1,wholesale_price_cnf:[]}),D=J(()=>{let e=0;for(let s=0;s<o.value.wholesale_price_cnf.length;s++){const n=o.value.wholesale_price_cnf[s];if(l.buy_num>=n.buy_num){e=n.price*l.buy_num;break}else e=o.value.retail_price*l.buy_num}return M(e)});function M(e){let s="";const n=Math.floor(e/1e4),b=Math.floor(e%1e4/100),x=e%100;return n&&(s+=n+" 金币"),b&&(s+=b+" 银币"),x&&(s+=x+" 铜币"),s}function H(){ee(l.gd_no).then(e=>{o.value={...e,wholesale_price_cnf:e.wholesale_price_cnf.map(s=>{const n=s.split("=");return{buy_num:+n[0],price:+n[1]}}).sort((s,n)=>n.buy_num-s.buy_num),other_ipu_cnf:e.other_ipu_cnf.map(s=>{const n=s.split("=");return{key:n[0],label:n[1],required:n[2]==="true",status:""}})}}).catch(()=>{l.gd_no=""})}function V(e){if(e)e.startsWith("http")?open(e,"_blank"):S({url:e,hideError:!0}).then(()=>{v.value=!1}).catch(s=>{v.value=!0,j.alert({content:s.data.message})});else return}const l=L({buy_num:1,gd_no:"",other_ipu:{}}),h=L({orderNo:"",payCheck:""});K(l,T);function T(){o.value.other_ipu_cnf.forEach(e=>{e.required&&!l.other_ipu[e.key]?e.status="error":e.status=""})}function E(){if(T(),o.value.other_ipu_cnf.some(e=>e.status)){P.error({content:"请填写完整信息"});return}if(!C.account_id){j.info({title:"请登录",content:"请先登录后再购买"});return}o.value.pre_api_hook&&V(o.value.pre_api_hook),f.value=!0}const f=y(!1),w=y(!1);function A(){w.value=!0,se(l).then(e=>{h.orderNo=e.order_no,F(),f.value=!1}).finally(()=>{w.value=!1})}const v=y(!1);function F(){ae(h).catch(e=>{var s,n;e.status===303&&(n=(s=e.data)==null?void 0:s.data)!=null&&n.hook_url&&S({url:e.data.data.hook_url,method:"post"}).then(()=>{P.success("支付成功"),q.push("/order")})})}const B=y([]);function G(){te().then(e=>{B.value=e,h.payCheck=e[0].pay_check}).catch(()=>{})}return Q(()=>{l.gd_no=U.query.id||"",l.gd_no&&(H(),C.account_id&&G())}),(e,s)=>{const n=p("a-input-number"),b=p("a-radio-button"),x=p("a-radio-group"),O=p("a-input"),g=p("a-button"),R=p("a-result"),I=p("a-modal");return u(),c(m,null,[l.gd_no?(u(),c("div",oe,[t("div",ne,[t("div",le,[t("img",{src:o.value.picture,alt:"",class:"w-28 h-28 rounded"},null,8,re),t("div",ue,[t("p",ce,[t("span",null,r(o.value.gd_name),1)]),t("div",ie,[t("p",null,[t("span",_e,"已售："+r(o.value.sales_volume),1),t("span",de,"库存："+r(o.value.in_stock),1)]),t("span",pe,"单价："+r(o.value.retail_price_label),1)])])]),t("div",he,[(u(!0),c(m,null,k(o.value.gd_keywords,a=>(u(),c("span",{key:l.gd_no+a,class:"py-2 px-4 mr-2 rounded bg-gray-200 text-gray-700 dark:bg-gray-500 dark:text-gray-200"},r(a),1))),128))]),t("div",fe,[ye,t("p",{class:"text-gray-500 py-2",innerHTML:o.value.gd_description},null,8,me)])]),t("div",ve,[t("div",be,[xe,t("div",ge,[_(n,{value:l.buy_num,"onUpdate:value":s[0]||(s[0]=a=>l.buy_num=a),controls:!1,max:o.value.in_stock,min:1,precision:0,class:"w-[190px]"},null,8,["value","max"])])]),t("div",ke,[(u(!0),c(m,null,k(o.value.wholesale_price_cnf,a=>(u(),c("p",{key:a.buy_num},[d(" 购买"),t("span",we,r(a.buy_num),1),d("个按照"),t("span",Ce,r(M(a.price)),1),d("售卖 ")]))),128))]),t("div",Me,[Te,t("div",Be,[_(x,{value:h.payCheck,"onUpdate:value":s[1]||(s[1]=a=>h.payCheck=a),"button-style":"solid"},{default:i(()=>[(u(!0),c(m,null,k(B.value,a=>(u(),N(b,{key:a.pay_check,value:a.pay_check},{default:i(()=>[d(r(a.pay_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),(u(!0),c(m,null,k(o.value.other_ipu_cnf,a=>(u(),c("div",{key:a.key,class:"mb-2"},[t("div",Le,[t("p",Ne,r(a.label)+"：",1),t("div",Pe,[_(O,{value:l.other_ipu[a.key],"onUpdate:value":W=>l.other_ipu[a.key]=W,placeholder:"请输入"+a.label,status:a.status,class:"w-[190px]"},null,8,["value","onUpdate:value","placeholder","status"])])]),a.status?(u(),c("p",je,r("请输入"+a.label),1)):Z("",!0)]))),128)),t("div",Se,[Ue,t("div",qe,r(D.value),1)]),t("div",null,[_(g,{disabled:v.value,class:"w-full",type:"primary",onClick:E},{default:i(()=>[d(r(v.value?"你不配":"立即购买"),1)]),_:1},8,["disabled"])])])])):(u(),N(R,{key:1,class:"bg-white w-[1200px] m-auto rounded-2xl",status:"404","sub-title":"抱歉, 您访问的商品不存在。",title:"没找到商品"},{extra:i(()=>[_(g,{type:"primary"},{default:i(()=>[d("首页")]),_:1})]),_:1})),_(I,{open:f.value,"onUpdate:open":s[3]||(s[3]=a=>f.value=a),maskClosable:!1,destroyOnClose:"",title:"购买提示"},{footer:i(()=>[_(g,{onClick:s[2]||(s[2]=a=>f.value=!1)},{default:i(()=>[d("再考虑一下")]),_:1}),_(g,{loading:w.value,type:"primary",onClick:A},{default:i(()=>[d("已知晓，继续购买 ")]),_:1},8,["loading"])]),default:i(()=>[t("div",{innerHTML:o.value.buy_prompt},null,8,De)]),_:1},8,["open"])],64)}}});export{Fe as default};
