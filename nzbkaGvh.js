import{d as J,f as K,k as m,j as Q,r as L,w as X,o as Y,c,e,x as r,q as M,F as v,G as g,p as i,m as d,l as T,a as Z,u as ee,H as P,M as j,n as _,b as u,v as p,t as te,I as N}from"./assets/index-BZ3WimOh.js";import{a as ae}from"./Db2zwojg.js";import{g as se,c as oe,a as ne}from"./DQpNBRKb.js";import{f as k}from"./ChjVMTjJ.js";const le={key:0,class:"detail w-[1100px] mx-auto my-0 flex"},re={class:"w-[600px] mr-4"},ue={class:"flex bg-white dark:bg-gray-700 p-4 rounded mb-4"},ce=["src"],ie={class:"flex-1 pl-4"},de={class:"text-4xl text-gray-800 dark:text-gray-100 mb-8"},_e={class:"flex justify-between items-end"},pe={class:"mr-4"},he={class:"mr-4"},ye={class:"text-red-500 text-2xl"},fe={class:"bg-white dark:bg-gray-700 p-4 flex flex-wrap rounded mb-4"},me={class:"bg-white dark:bg-gray-700 p-4 rounded mb-4"},ve=e("p",{class:"text-xl mb-2"},"商品详情：",-1),be=["innerHTML"],xe={class:"bg-white dark:bg-gray-700 p-4 rounded mb-4 w-[480px] h-[min-content]"},ge={class:"flex justify-between items-center mb-2"},ke=e("p",{class:"text-xl"},"购买数量：",-1),we={class:"flex"},Ce={class:"mb-2 text-gray-500"},Be={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Le={class:"px-2 py-1 border-dashed border-gray-400 rounded text-red-500"},Me={class:"flex justify-between items-center mb-2"},Te=e("p",{class:"text-xl"},"支付方式：",-1),Pe={class:"flex"},je={class:"flex justify-between items-center"},Ne={class:"text-xl"},Se={class:"flex"},Ue={key:0,class:"text-right text-red-500"},qe={class:"flex justify-between items-center mb-2"},De=e("p",{class:"text-xl"},"总价：",-1),He={class:"flex text-red-500 text-2xl"},Ve=["innerHTML"],Re=J({__name:"index",setup(Ee){const S=Z(),U=ee(),w=K(),o=m({actual_price:0,actual_price_label:"",buy_limit_num:0,buy_prompt:"",created_at:"",gd_description:"",gd_keywords:[],gd_name:"",gd_no:"",in_stock:0,is_automatic:0,ord:0,other_ipu_cnf:[],picture:"",retail_price:0,retail_price_label:"",sales_volume:0,type:1,wholesale_price_cnf:[]}),q=Q(()=>{let t=0;for(let s=0;s<o.value.wholesale_price_cnf.length;s++){const l=o.value.wholesale_price_cnf[s];if(n.buy_num>=l.buy_num){t=l.price*n.buy_num;break}else t=o.value.retail_price*n.buy_num}return k(t)});function D(){ae(n.gd_no).then(t=>{o.value={...t,wholesale_price_cnf:t.wholesale_price_cnf.map(s=>{const l=s.split("=");return{buy_num:+l[0],price:+l[1]}}).sort((s,l)=>l.buy_num-s.buy_num),other_ipu_cnf:t.other_ipu_cnf.map(s=>{const l=s.split("=");return{key:l[0],label:l[1],required:l[2]==="true",status:""}})}}).catch(()=>{n.gd_no=""})}function H(t){if(t)t.startsWith("http")?open(t,"_blank"):N({url:t,hideError:!0}).then(()=>{b.value=!1}).catch(s=>{b.value=!0,j.alert({content:s.data.message})});else return}const n=L({buy_num:1,gd_no:"",other_ipu:{}}),h=L({orderNo:"",payCheck:""});X(n,C);function C(){o.value.other_ipu_cnf.forEach(t=>{t.required&&!n.other_ipu[t.key]?t.status="error":t.status=""})}function V(){if(C(),o.value.other_ipu_cnf.some(t=>t.status)){P.error({content:"请填写完整信息"});return}if(!w.account_id){j.info({title:"请登录",content:"请先登录后再购买"});return}o.value.pre_api_hook&&H(o.value.pre_api_hook),y.value=!0}const y=m(!1),f=m(!1);function E(){f.value=!0,oe(n).then(t=>{h.orderNo=t.order_no,F()}).catch(()=>{f.value=!1})}const b=m(!1);function F(){ne(h).catch(t=>{var s,l;t.status===303&&(l=(s=t.data)==null?void 0:s.data)!=null&&l.hook_url&&N({url:t.data.data.hook_url,method:"post"}).then(()=>{P.success("支付成功"),U.push("/order")}).finally(()=>{f.value=!1,y.value=!1})})}const B=m([]);function A(){se().then(t=>{B.value=t,h.payCheck=t[0].pay_check}).catch(()=>{})}return Y(()=>{n.gd_no=S.query.id||"",n.gd_no&&(D(),w.account_id&&A())}),(t,s)=>{const l=_("a-input-number"),G=_("a-radio-button"),O=_("a-radio-group"),R=_("a-input"),x=_("a-button"),I=_("a-result"),W=_("a-back-top"),$=_("a-modal");return u(),c(v,null,[n.gd_no?(u(),c("div",le,[e("div",re,[e("div",ue,[e("img",{src:o.value.picture,alt:"",class:"w-28 h-28 rounded"},null,8,ce),e("div",ie,[e("p",de,[e("span",null,r(o.value.gd_name),1)]),e("div",_e,[e("p",null,[e("span",pe,"已售："+r(o.value.sales_volume),1),e("span",he,"库存："+r(o.value.in_stock),1)]),e("span",ye,"单价："+r(M(k)(o.value.retail_price)),1)])])]),e("div",fe,[(u(!0),c(v,null,g(o.value.gd_keywords,a=>(u(),c("div",{key:n.gd_no+a,class:"py-2 px-4 mr-2 rounded bg-gray-200 text-gray-700 dark:bg-gray-500 dark:text-gray-200"},r(a),1))),128))]),e("div",me,[ve,e("p",{class:"text-gray-500 dark:text-gray-200 py-2",innerHTML:o.value.gd_description},null,8,be)])]),e("div",xe,[e("div",ge,[ke,e("div",we,[i(l,{value:n.buy_num,"onUpdate:value":s[0]||(s[0]=a=>n.buy_num=a),controls:!1,max:o.value.in_stock,min:1,precision:0,class:"w-[190px]"},null,8,["value","max"])])]),e("div",Ce,[(u(!0),c(v,null,g(o.value.wholesale_price_cnf,a=>(u(),c("p",{key:a.buy_num},[p(" 购买"),e("span",Be,r(a.buy_num),1),p("个按照"),e("span",Le,r(M(k)(a.price)),1),p("售卖 ")]))),128))]),e("div",Me,[Te,e("div",Pe,[i(O,{value:h.payCheck,"onUpdate:value":s[1]||(s[1]=a=>h.payCheck=a),"button-style":"solid"},{default:d(()=>[(u(!0),c(v,null,g(B.value,a=>(u(),T(G,{key:a.pay_check,value:a.pay_check},{default:d(()=>[p(r(a.pay_name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])]),(u(!0),c(v,null,g(o.value.other_ipu_cnf,a=>(u(),c("div",{key:a.key,class:"mb-2"},[e("div",je,[e("p",Ne,r(a.label)+"：",1),e("div",Se,[i(R,{value:n.other_ipu[a.key],"onUpdate:value":z=>n.other_ipu[a.key]=z,placeholder:"请输入"+a.label,status:a.status,class:"w-[190px]"},null,8,["value","onUpdate:value","placeholder","status"])])]),a.status?(u(),c("p",Ue,r("请输入"+a.label),1)):te("",!0)]))),128)),e("div",qe,[De,e("div",He,r(q.value),1)]),e("div",null,[i(x,{disabled:b.value,class:"w-full",type:"primary",onClick:V},{default:d(()=>[p(r(b.value?"你不配":"立即购买"),1)]),_:1},8,["disabled"])])])])):(u(),T(I,{key:1,class:"bg-white dark:bg-gray-700 w-[1200px] m-auto rounded-2xl",status:"404","sub-title":"抱歉, 您访问的商品不存在。",title:"没找到商品"},{extra:d(()=>[i(x,{type:"primary"},{default:d(()=>[p("首页")]),_:1})]),_:1})),i(W),i($,{open:y.value,"onUpdate:open":s[3]||(s[3]=a=>y.value=a),maskClosable:!1,destroyOnClose:"",title:"购买提示"},{footer:d(()=>[i(x,{onClick:s[2]||(s[2]=a=>y.value=!1),disabled:f.value},{default:d(()=>[p("再考虑一下")]),_:1},8,["disabled"]),i(x,{loading:f.value,type:"primary",onClick:E},{default:d(()=>[p("已知晓，继续购买 ")]),_:1},8,["loading"])]),default:d(()=>[e("div",{innerHTML:o.value.buy_prompt},null,8,Ve)]),_:1},8,["open"])],64)}}});export{Re as default};
